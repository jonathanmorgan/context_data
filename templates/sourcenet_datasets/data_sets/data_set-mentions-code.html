{% extends "sourcenet/base.html" %}
{% load staticfiles %}

{% block title %}Code DataSetCitation mentions{% endblock %}

{% block inside-head %}
<script src="https://code.jquery.com/jquery-latest.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.selection/1.0.1/jquery.selection.min.js"></script>
<link rel="stylesheet" type="text/css" href="{% static "sourcenet_datasets/css/mention-coding/mention-coding.css" %}" />
<script src="{% static "sourcenet/js/sourcenet.js" %}"></script>
<script src="{% static "sourcenet/js/find-in-text.js" %}"></script>
<script src="{% static "sourcenet_datasets/js/mention-coding/mention-coding.js" %}"></script>
<script>SOURCENET.text_finder.be_case_sensitive = {% if be_case_sensitive %}true{% else %}false{% endif %};</script>
<script>SOURCENET.process_found_synonyms = {% if process_found_synonyms %}true{% else %}false{% endif %};</script>
{% if article_text_type == "text" %}
<script>
    SOURCENET.article_text_ignore_p_tags = true;
    SOURCENET.text_finder.ignore_wrapper_element = true;
</script>
{% else %}
<script>
    SOURCENET.article_text_ignore_p_tags = false;
    SOURCENET.text_finder.ignore_wrapper_element = false;
</script>
{% endif %}
{% if default_find_location != "" %}<script>SOURCENET.text_finder.default_find_location = "{{ default_find_location }}";</script>{% endif %}
{% if existing_data_store_json %}<script>SOURCENET.data_store_json = '{{ existing_data_store_json }}';</script>{% endif %}

{# got ignore word list? #}
{% if ignore_word_list %}
<script>
    var ignore_word_list = [];
    {% for ignore_word in ignore_word_list %}
    ignore_word_list.push( "{{ ignore_word }}" );
    {% endfor %}
    SOURCENET.FindInText.add_to_ignore_list( ignore_word_list );
</script>
{% endif %}

{# got highlight word list? #}
{% if highlight_word_list %}
<script>
    var highlight_word_list = [];
    {% for highlight_word in highlight_word_list %}
    highlight_word_list.push( "{{ highlight_word }}" );
    {% endfor %}
    SOURCENET.data_set_string_list = SOURCENET.data_set_string_list.concat( highlight_word_list );
</script>
{% endif %}

{% endblock %}

{% block content %}

<div class="contentBox">
    <article class="contentLeft">
        
        {# got page status message(s)? #}
        {% if page_status_message_list %}
            <div id="page-status-message-area" class="pageStatusMessageArea">
                <h4>Status Messages</h4>
                <ul>
                {% for page_status_message in page_status_message_list %}
                    <li>{{ page_status_message }}</li>
                {% endfor %}
                </ul>
            </div>
            <hr />
        {% endif %}

        <div id="return-to-source" class="returnToSource">
            <ul>
                {# if source, persist tag list for return to coding list page #}
                <li>
                    <a href="{% url 'sourcenet_datasets-dataset_mention_coding_list' %}{% if source %}?tags_in_list={{ tags_in_list }}{% endif %}">
                        {% if source %}Return to {% endif %}DataSetCitation mention coding List
                    </a>
                </li>
            </ul>
        </div>
        <hr />

        <h1>Code DataSetCitation mentions</h1>
        
        <div id="article_form" name="article_form">
            
            <form action="" method="post">
        
                {# always include CSRF token #}
                {% csrf_token %}
                    
                <p>
                    <table class="gridtable">
                        {# output DataSetCitation lookup form #}
                        {{ data_set_citation_lookup_form.as_table }}
                    </table>
                </p>
                
                {% if source %}
                    <input type="hidden" name="source" value="{{ source }}" />
                {% else %}
                    <input type="hidden" name="source" value="" />
                {% endif %}
                
                {% if tags_in_list %}
                    <input type="hidden" name="tags_in_list" value="{{ tags_in_list }}" />
                {% else %}
                    <input type="hidden" name="tags_in_list" value="" />
                {% endif %}
                            
                <p>
                    <input type="submit" value="Load DataSetCitation" />
                </p>
                
            </form>
            
        </div>
        
        {% if article_instance %}
        
            <hr />
            
            <div id="article_view" name="article_view">
                <h3>Article {{ article_instance.id }} - {{ article_instance.headline }}</h3>
                <ul>
                    {% if article_instance.section %}<li><em>Section:</em> {{ article_instance.section }}</li>{% endif %}
                    {% if article_instance.pub_date %}<li><em>Publication Date:</em> {{ article_instance.pub_date }}</li>{% endif %}
                    {% if article_instance.file_path %}<li><em>Original PDF:</em> <a target="_blank" href="/pdf/{{ article_instance.file_path }}">{{ article_instance.file_path }}</a></li>{% endif %}

                    {% if include_detail %}
                    <li><em>Page:</em> {{ article_instance.page }}</li>                
                    <li><em>Edition:</em> {{ article_instance.edition }}</li>                
                    <li><em>Terms:</em> {{ article_instance.index_terms }}</li>                
                    <li><em>Source:</em> {{ article_instance.archive_source }} ( <em>id:</em> {{ article_instance.archive_id }} )</li>
                    {% endif %}
                    {% if article_instance.author_string %}<li><em><strong>Byline:</strong></em> {{ article_instance.author_string }}</li>{% endif %}
                </ul>
                
                {% if article_text_wrap_in_p %}<p>{% endif %}
                {% if article_text_is_preformatted %}<pre>{% endif %}

                {# are we outputting HTML <table>, or plain text, custom, or PDF? #}
                <!-- {{ article_text_render_type }} -->
                {% if article_text_render_type == "table" %}
                    {{ article_content | safe }}
                {% elif article_text_render_type == "custom" %}
                    {{ article_text_custom | safe }}
                {% elif article_text_render_type == "pdf" %}
                    <iframe src="/pdf/{{ article_instance.file_path }}" width="630" height="820"></iframe>
                {% else %}
                    {{ article_text.get_content | safe }}
                {% endif %}

                {% if article_text_is_preformatted %}</pre>{% endif %}
                {% if article_text_wrap_in_p %}</p>{% endif %}

                <p id="article_end" name="article_end" class="articleEnd">-- 30 --</p>
            </div>
            
            <hr />
            
        {% endif %}
    </article>
    <aside class="sidebarBox">
        <div class="scrollingBox">
            <h2>Record Data Set Mentions</h2>
            <!-- <form name="person-coding" id="person-coding"> -->
            <div name="mention-coding" id="mention-coding">
<!--
                <input type="hidden" name="{{ manual_article_coder.INPUT_ID_MATCHED_PERSON_ID }}" id="{{ manual_article_coder.INPUT_ID_MATCHED_PERSON_ID }}" />
                <input type="hidden" name="{{ manual_article_coder.INPUT_ID_ARTICLE_PERSON_ID }}" id="{{ manual_article_coder.INPUT_ID_ARTICLE_PERSON_ID }}" />
                <input type="hidden" name="{{ manual_article_coder.INPUT_ID_ORIGINAL_PERSON_TYPE }}" id="{{ manual_article_coder.INPUT_ID_ORIGINAL_PERSON_TYPE }}" />
                <input type="hidden" name="{{ manual_article_coder.INPUT_ID_DATA_STORE_PERSON_INDEX }}" id="{{ manual_article_coder.INPUT_ID_DATA_STORE_PERSON_INDEX }}" />
-->
<!--
                <input type="button" id="select-text" value="Get selected text" />:
                <br />
                <textarea id="selected-text" readonly="readonly" rows="4" cols="35"></textarea>
                <br />
-->
                <p class="inputContainer" id="input-mention-text" name="input-mention-text">
                    <input type="button" id="store-mention" name="store-mention" value="Mention ==>" />: 
                    {% if mention_text_read_only %}
                    <textarea id="{{ manual_coder.INPUT_ID_MENTION_TEXT }}" name="{{ manual_coder.INPUT_ID_MENTION_TEXT }}" readonly="readonly"></textarea>
                    {% else %}
                    <textarea id="{{ manual_coder.INPUT_ID_MENTION_TEXT }}" name="{{ manual_coder.INPUT_ID_MENTION_TEXT }}"></textarea>
                    {% endif %}
                </p>
                {% if include_fix_mention_text %}
                    <p class="inputContainer" id="fix-mention-text-link" name="fix-mention-text-link">
                        <a href="#" onclick="SOURCENET.fix_mention_text(); return false;">--> Fix Mention Text</a>
                    </p>
                    <p class="inputContainer hidden" id="fix-mention-text" name="fix-mention-text">
                        <a href="#" onclick="SOURCENET.cancel_fix_mention_text(); return false;"><-- Cancel Fix Mention Text</a>
                        <br />
                        <input type="button" id="fix-mention-text" name="fix-mention-text" value="==> Fix Mention Text" />: <textarea id="{{ manual_coder.INPUT_ID_FIXED_MENTION_TEXT }}" name="{{ manual_coder.INPUT_ID_FIXED_MENTION_TEXT }}"></textarea>
                    </p>
                {% else %}
                    <input type="hidden" name="{{ manual_coder.INPUT_ID_FIXED_MENTION_TEXT }}" id="{{ manual_coder.INPUT_ID_FIXED_MENTION_TEXT }}" />
                {% endif %}
                
<!--
                <p class="inputContainer" id="select-mention-type">
                    &nbsp;&nbsp;Mention Type: <select name="{{ manual_coder.INPUT_ID_MENTION_TYPE }}" id="{{ manual_coder.INPUT_ID_MENTION_TYPE }}" onchange="SOURCENET.process_selected_mention_type()">
                        <option value="" selected="selected" disabled="disabled">Choose Mention Type</option>
                        <option value="{{ manual_coder.MENTION_TYPE_CITED }}">{{ manual_coder.MENTION_TYPE_CITED }}</option>
                        <option value="{{ manual_coder.MENTION_TYPE_ANALYZED }}">{{ manual_coder.MENTION_TYPE_ANALYZED }}</option>
                    </select>
                </p>
-->

                <!-- <hr class="fieldSeparator" /> -->
                <p class="inputContainer" id="process-mention-container">
                    <input type="button" id="process-mention" name="process-mention" value="Process Mention" onclick="SOURCENET.process_mention_coding()" />&nbsp;&nbsp;|&nbsp;&nbsp;<input type="button" id="clear-mention-coding" name="clear-mention-coding" value="Clear Mention Coding" onclick="SOURCENET.clear_coding_form( 'Mention Coding Cleared' )" />
                </p>
            </div>
            <!-- </form> -->
            <hr class="fieldSeparator" />
            <div id="status-message-area" class="statusMessageArea">
                <h4>Status Messages</h4>
            </div>
            <h3>Mention List</h3>
            <div id="mention-list" class="mentionList">
                <table id="mention-list-table" class="mentionListTable"></table>
                <form method="post" name="submit-article-coding" id="submit-article-coding" class="submitArticleCoding" onsubmit="do_submit = SOURCENET.render_coding_form_inputs( this ); return do_submit;">
                    {# always include CSRF token #}
                    {% csrf_token %}
                    {# output coding_submit_form if present #}
                    {% if coding_submit_form %}
                        {{ coding_submit_form }}
                    {% endif %}
                    <input type="hidden" name="data_set_citation_id" id="submit-article-coding-data-set-citation-id" value="{{ citation_instance.id }}" />

                    {% if source %}
                        <input type="hidden" name="source" value="{{ source }}" />
                    {% else %}
                        <input type="hidden" name="source" value="" />
                    {% endif %}
                    
                    {% if tags_in_list %}
                        <input type="hidden" name="tags_in_list" value="{{ tags_in_list }}" />
                    {% else %}
                        <input type="hidden" name="tags_in_list" value="" />
                    {% endif %}
                            
                    <input type="submit" value="Submit Article Coding" name="input-submit-article-coding" id="input-submit-article-coding" />
                </form>
            </div>

            {% if include_find_in_article_text %}
            <hr />
            <p class="inputContainer" id="find-text-in-article-text" name="find-text-in-article-text">
                <h4><em>Find in Article Text</em></h4>
                <table>
                    <tr>
                        <td>
                            Search for:
                            <br />
                            <input type="text" name="{{ manual_coder.INPUT_ID_TEXT_TO_FIND_IN_ARTICLE }}" id="{{ manual_coder.INPUT_ID_TEXT_TO_FIND_IN_ARTICLE }}" size="25" />
                            <br />
                            <input type="button" id="find-in-article-text" name="find-in-article-text" value="<== Find in Text" />
                            <br />
                            <input type="button" id="find-words-in-article-text" name="find-words-in-article-text" value="<== Find Words in Text" />
                            <br />
                            <input type="button" id="clear-find-in-article-text" name="clear-find-in-article-text" value="<== Clear Matches" />
                        </td>
                        <td>
                            <input type="button" id="find-mention-in-article-text" name="find-mention-in-article-text" value="<== Mention" />
                        </td>
                    </tr>
                </table>
            </p>
            {% else %}
            <input type="hidden" name="{{ manual_article_coder.INPUT_ID_TEXT_TO_FIND_IN_ARTICLE }}" id="{{ manual_article_coder.INPUT_ID_TEXT_TO_FIND_IN_ARTICLE }}" />
            {% endif %}
            
            <hr />
            <h2>Data Set Info</h2>
            <!--
                <script>
                    // initialized in mention-coding.js
                    //SOURCENET.data_set_string_list = [];
                </script>
            -->
            {% if data_set_instance %}
            <input type="button" id="toggle-data-set_highlighting" name="toggle-data-set_highlighting" value="<== highlight OFF" />
            <h3>Data Set {{ data_set_instance.id }} - {{ data_set_instance.name }}</h3>
            <script>
                SOURCENET.data_set_string_list.push( "{{ data_set_instance.name }}".trim() );
            </script>
            <ul>
                {% if data_set_instance.title %}
                    <li><em>Title:</em> {{ data_set_instance.title }}</li>
                    <script>
                        SOURCENET.data_set_string_list.push( "{{ data_set_instance.title }}".trim() );
                    </script>
                {% endif %}
                {% if data_set_instance.date %}<li><em>Date:</em> {{ data_set_instance.date }}</li>{% endif %}
                {% if data_set_instance.description %}<li><em>Description:</em> {{ data_set_instance.description }}</li>{% endif %}
                {% if data_set_instance.coverages %}<li><em>Coverages:</em> {{ data_set_instance.coverages }}</li>{% endif %}
                {% if data_set_instance.subjects %}<li><em>Subjects:</em> {{ data_set_instance.subjects }}</li>{% endif %}
                {% if data_set_instance.methodology %}<li><em>Methodology:</em> {{ data_set_instance.methodology }}</li>{% endif %}
                {% if data_set_instance.citation %}<li><em>Citation:</em> {{ data_set_instance.citation }}</li>{% endif %}
                {% if data_set_instance.additional_keywords %}
                    <li><em>Additional keywords:</em> {{ data_set_instance.additional_keywords }}</li>
                    <script>
                        var temp_string = "";
                        var temp_string_list = [];
                        var temp_item = "";
                        temp_string = "{{ data_set_instance.additional_keywords }}";
                        temp_string_list = temp_string.split( "," );
                        for( var i = 0; i < temp_string_list.length; i ++ )
                        {
                            temp_item = temp_string_list[ i ];
                            SOURCENET.data_set_string_list.push( temp_item.trim() );
                        }
                    </script>
                {% endif %}
                <li>
                    Identifiers:
                    <ul>
                        {% for data_set_identifier in data_set_instance.datasetidentifier_set.all %}
                        <li>{{ data_set_identifier.name }} - {{ data_set_identifier.identifier }}</li>
                        <script>
                            SOURCENET.data_set_string_list.push( "{{ data_set_identifier.identifier }}".trim() );
                        </script>
                        {% endfor %}
                    </ul>
                </li>
                {% if data_set_mention_list %}
                <li>
                    Synonyms:
                    <ul>
                        {% for mention in data_set_mention_list %}
                        <li>{{ mention }}</li>
                        <script>
                            SOURCENET.data_set_mention_list.push( "{{ mention }}".trim() );
                        </script>
                        {% endfor %}
                    </ul>
                </li>
                {% endif %}
            </ul>
            {% endif %}
        </div>
    </aside>
</div>

{% endblock %}